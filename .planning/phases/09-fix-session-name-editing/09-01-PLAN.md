# Plan 09-01: Fix NewSession Enter Key After Name Editing

## Problem

When creating a new session:
1. User selects a directory → enters NewSession screen in `EnteringLayoutSearch` state
2. User presses Esc to go back and edit the name → now in `EnteringName` state
3. User edits the name (e.g., "vaultsync_templates")
4. User presses Enter → **immediately returns to Main screen without creating session**

**Root cause:** In `handle_new_session_key()`, pressing Enter always sets `active_screen = Main` after calling `handle_selection()`, even when `handle_selection()` just advances from `EnteringName` to `EnteringLayoutSearch` (doesn't create the session yet).

```rust
BareKey::Enter if key.has_no_modifiers() => {
    self.new_session_info.handle_selection(&self.current_session_name);
    self.active_screen = ActiveScreen::Main;  // BUG: Always goes to Main!
    true
}
```

In `handle_selection()`:
- `EnteringName` → just advances to `EnteringLayoutSearch` (no session created)
- `EnteringLayoutSearch` → creates session, calls `hide_self()`

## Solution

Only set `active_screen = Main` when the user was already in `EnteringLayoutSearch` (meaning `handle_selection()` created the session). If user was in `EnteringName`, stay on NewSession screen to show layout selection.

## Changes

### `src/state.rs` - Fix Enter handler in `handle_new_session_key()`

**Location:** Lines 420-426

**Current code:**
```rust
BareKey::Enter if key.has_no_modifiers() => {
    // Handle session creation
    self.new_session_info
        .handle_selection(&self.current_session_name);
    self.active_screen = ActiveScreen::Main;
    true
}
```

**New code:**
```rust
BareKey::Enter if key.has_no_modifiers() => {
    // Only return to Main if we were in layout selection (session created)
    // If in name entry, handle_selection just advances to layout selection
    let was_in_layout_selection = self.new_session_info.entering_layout_search_term();
    self.new_session_info
        .handle_selection(&self.current_session_name);
    if was_in_layout_selection {
        self.active_screen = ActiveScreen::Main;
    }
    true
}
```

## Validation

1. Build: `cargo build --target wasm32-wasip1`
2. Test manually:
   - Select a directory from main list
   - Press Esc to go back to name entry
   - Edit the session name
   - Press Enter → should show layout selection (not return to main)
   - Press Enter again → should create session

## Files Changed

- `src/state.rs` - Fix Enter handler in `handle_new_session_key()`

## Estimated Complexity

Trivial - single conditional check.
