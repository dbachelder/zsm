---
phase: 07-fix-session-naming-bug
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/state.rs, src/ui/renderer.rs]
autonomous: true
---

<objective>
Add session rename capability to allow users to rename the current session.

Purpose: When session naming creates `.2` suffix due to resurrectable sessions, users can rename to their preferred name.
Output: New `Ctrl+n` keybinding that prompts for new session name and renames the current session.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/state.rs
@src/ui/renderer.rs
@src/main.rs
</context>

<background>
The session naming logic in `generate_incremented_name()` checks both existing AND resurrectable sessions to avoid conflicts. This is correct behavior (prevents accidentally resurrecting wrong session), but can be confusing when users see `.2` suffix without understanding why.

Solution: Add ability to rename the current session using `zellij_tile::prelude::rename_session()` API.

Note: `rename_session(name)` only renames the CURRENT session. Cannot rename arbitrary sessions by ID.
</background>

<tasks>

<task type="auto">
  <name>Task 1: Add rename screen state and handler</name>
  <files>src/state.rs</files>
  <action>
1. Add `Rename` variant to `ActiveScreen` enum
2. Add `rename_buffer: String` field to `PluginState` to hold the new name being typed
3. Add `Ctrl+n` handler in `handle_main_screen_key()` that:
   - Sets `rename_buffer` to current session name (or empty string)
   - Switches to `ActiveScreen::Rename`
4. Add `handle_rename_screen_key()` method:
   - `Enter`: If valid name (non-empty, <108 chars, no '/'), call `rename_session(&self.rename_buffer)`, update `self.current_session_name`, switch back to Main
   - `Esc`: Clear buffer, switch back to Main
   - `Char(c)`: Append to `rename_buffer`
   - `Backspace`: Remove last char from `rename_buffer`
5. Add the match arm in `handle_key()` for `ActiveScreen::Rename`
  </action>
  <verify>cargo build --target wasm32-wasip1 compiles without errors</verify>
  <done>Rename screen state exists, Ctrl+n triggers it, Enter/Esc/typing work</done>
</task>

<task type="auto">
  <name>Task 2: Add rename screen rendering and help text</name>
  <files>src/ui/renderer.rs</files>
  <action>
1. Add `ActiveScreen::Rename` match arm in `PluginRenderer::render()` that calls new `render_rename_screen()`
2. Implement `render_rename_screen()`:
   - Show prompt: "Rename session:"
   - Show current input: "{rename_buffer}_" (with cursor indicator)
   - Show help: "Enter: Confirm â€¢ Esc: Cancel"
3. Update help text in `render_help_text()` row 2 to include "Ctrl+n: Rename" for main screen
  </action>
  <verify>cargo build --target wasm32-wasip1 compiles without errors</verify>
  <done>Rename screen renders with prompt and help text, main screen shows Ctrl+n hint</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build --target wasm32-wasip1` succeeds
- [ ] `cargo clippy --target wasm32-wasip1 -- -D warnings` passes
- [ ] `cargo fmt --check` passes
</verification>

<success_criteria>
- All tasks completed
- Ctrl+n from main screen enters rename mode
- Typing updates the rename buffer
- Enter confirms and calls rename_session()
- Esc cancels and returns to main screen
- Help text shows Ctrl+n: Rename option
</success_criteria>

<output>
After completion, create `.planning/phases/07-fix-session-naming-bug/07-01-SUMMARY.md`
</output>
