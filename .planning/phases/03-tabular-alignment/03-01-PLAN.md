---
phase: 03-tabular-alignment
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/ui/renderer.rs]
autonomous: true
---

<objective>
Align session names and directory paths in clean columns for improved readability.

Purpose: Replace the current inline format `● session (dir)` with a tabular layout where session names and directories align vertically, making the list easier to scan.
Output: Updated renderer with columnar session display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/ui/renderer.rs
@src/session/types.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement columnar layout in render_item</name>
  <files>src/ui/renderer.rs</files>
  <action>
Modify `render_item()` and `render_all_items()` to display sessions in aligned columns:

1. Add a helper method `calculate_name_column_width(items: &[SessionItem]) -> usize` that:
   - Finds the max session name length across all ExistingSession and ResurrectableSession items
   - Adds 2 for the bullet/icon prefix ("● " or "↺ ")
   - Caps at a reasonable max (e.g., 35 chars) to leave room for directory
   - Returns the column width

2. Modify `render_all_items()` to:
   - Calculate name column width once before the loop
   - Pass the width to `render_item()`

3. Modify `render_item()` signature to accept `name_col_width: usize`:
   - For ExistingSession: Format as `● name` padded to name_col_width, then `directory`
     - Use format!("{:<width$}", prefix + name, width = name_col_width) for padding
     - Color the session name portion (after bullet) with emphasis color
     - Leave directory as default foreground for visual separation
   - For ResurrectableSession: Format as `↺ name` padded to name_col_width, then `(X ago)`
   - For Directory: No change (directories don't have the two-column format)

4. Update the display format:
   - Current: `● session-name (directory)`
   - New: `● session-name    directory` (name padded, directory left-aligned after gap)

5. Handle truncation:
   - If name exceeds name_col_width, truncate with "..." at end
   - Directory should use remaining width after name column + gap (2 chars)
   - Use existing `get_truncated_text` logic for directory if needed

Color scheme (preserve existing):
- ExistingSession bullet: default foreground (uncolored)
- ExistingSession name: emphasis 1 (cyan) for normal, emphasis 2 (green) for current
- Directory path: default foreground (dimmer visual hierarchy)
  </action>
  <verify>cargo build --target wasm32-wasip1 succeeds</verify>
  <done>
- Sessions display with aligned columns
- Session names left-padded to consistent width
- Directory paths start at same column position for all sessions
- Colors preserved (bullets uncolored, names colored, dirs default)
  </done>
</task>

<task type="auto">
  <name>Task 2: Update search results rendering for columnar format</name>
  <files>src/ui/renderer.rs</files>
  <action>
Update `render_search_results()` and `render_search_result_item()` to use the same columnar format:

1. In `render_search_results()`:
   - Extract items from results: `results.iter().map(|r| &r.item).collect()`
   - Calculate name column width from these items
   - Pass width to `render_search_result_item()`

2. In `render_search_result_item()`:
   - Accept `name_col_width: usize` parameter
   - Pass it through to `render_item()`
   - Adjust search highlighting indices to account for padding:
     - For ExistingSession: indices are for the name portion, adjust by prefix (2 chars)
     - Padding spaces between name and directory don't affect highlighting
     - Directory indices need to be offset by name_col_width + gap

3. The search matching happens against `SessionItem::name()` which returns session name.
   Match indices should align with where the name appears in the new format.

Handle edge case: If search term matches across name/directory boundary (unlikely but possible),
only highlight the matched portions, don't try to span the gap.
  </action>
  <verify>cargo build --target wasm32-wasip1 && cargo test</verify>
  <done>
- Search results show same columnar alignment as main list
- Search highlighting correctly positioned despite padding
- No visual glitches when scrolling search results
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build --target wasm32-wasip1` succeeds without errors
- [ ] `cargo test` passes
- [ ] `cargo clippy --target wasm32-wasip1 -- -D warnings` passes
</verification>

<success_criteria>
- All tasks completed
- Session list displays in clean columnar format
- Session names align vertically
- Directory paths start at consistent column position
- Search highlighting works correctly with new format
- No regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/03-tabular-alignment/03-01-SUMMARY.md`
</output>
